angular.module("aggApp",["ngRoute","ngSanitize","ui.bootstrap"]).config(["$routeProvider","$locationProvider","$sceDelegateProvider",function(e,t,o){e.when("/",{templateUrl:"components/index.controller.html",controller:"indexCtrl",controllerAs:"vm"}).when("/posts/:id",{templateUrl:"posts/post.controller.html",controller:"postsCtrl",controllerAs:"vm"}).when("/users/:id",{templateUrl:"users/user.controller.html",controller:"usersCtrl",controllerAs:"vm"}).when("/users/:id/:idd",{templateUrl:"addPosts/addPost.controller.html",controller:"addPostsCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"login/login.controller.html",controller:"loginCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"register/register.controller.html",controller:"registerCtrl",controllerAs:"vm"}).when("/editProfile/:id",{templateUrl:"editProfile/editProfile.controller.html",controller:"editProfileCtrl",controllerAs:"vm"}).when("/editPost/:id",{templateUrl:"posts/editPost.controller.html",controller:"editPostCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.html5Mode(!0),o.resourceUrlWhitelist(["self","https://www.youtube.com/**"])}]),function(){function e(e,o,t,s,r){var a=this;a.naslov="Laka",a.posts=[],a.pages=0,a.maxNaStran=10,s.getPosts().then(function(e){a.posts=[];var t=[];t=e.data,a.pages=t.length,a.strani=Math.ceil(a.pages/a.maxNaStran),a.trenStran=1;var o=a.pages,s=(a.trenStran-1)*a.maxNaStran,r=s+a.maxNaStran;a.trenStran*a.maxNaStran>o&&(r-=a.trenStran*a.maxNaStran-o);for(var n=s;n<r;n++)a.posts.push(t[n]),0;console.log(e),t=[]},function(e){console.error(e)}),r.getUsers().then(function(e){a.users=e.data,console.log(e)},function(e){console.error(e)}),a.modalOkno=function(){t.open({templateUrl:"/modalnaOkna/addPost/addPost.controller.html",controller:"addPostCtrl",controllerAs:"vm"})},a.checkBtn=function(e){return-1==o.rootUser.postReactions.indexOf(e)?"btn-circle btn-circle-default":"btn-circle btn-circle-success"},a.reactP=function(e){var t=o.rootUser.postReactions.indexOf(e);-1==t?(a.user=o.rootUser,a.user.postReactions.push(e),s.getPostByID(e).then(function(e){a.post=e.data,a.post.likes=a.post.likes+1,r.updateUser(a.user._id,a.user).then(function(e){s.editPost(a.post._id,a.post.title,a.post.owner,a.post.body,a.post.description,a.post.hashtags,a.post.likes,a.post.dislikes,a.post.comments).then(function(e){a.response="success"},function(e){console.error(e),a.response="errorPost"})},function(e){console.error(e),a.response="errorUser"})},function(e){console.error(e),a.response="errorPost"})):(a.user=o.rootUser,a.user.postReactions.splice(t,1),s.getPostByID(e).then(function(e){a.post=e.data,a.post.likes=a.post.likes-1,r.updateUser(a.user._id,a.user).then(function(e){s.editPost(a.post._id,a.post.title,a.post.owner,a.post.body,a.post.description,a.post.hashtags,a.post.likes,a.post.dislikes,a.post.comments).then(function(e){a.response="success"},function(e){console.error(e),a.response="errorPost"})},function(e){console.error(e),a.response="errorUser"})},function(e){console.error(e),a.response="errorPost"}))},a.search=function(e){console.log("blaa");var n=a.searchStr;if(new RegExp("^(?=.{1,50}$)[a-žA-Ž0-9#( )]+$").test(n)){if(1==e&&null!=n&&""!=n){var i=a.searchStr.split(" ");s.getPosts().then(function(e){a.posts=[],a.postsTemp=e.data;for(var t=0;t<a.postsTemp.length;t++){if(0==n.toLowerCase().localeCompare(a.postsTemp[t].title.toLowerCase()))a.posts.push(a.postsTemp[t]);else for(var o=0;o<a.postsTemp[t].hashtags.length;o++)for(var s=0;s<i.length;s++){var r=i[s];"#"!=i[s].charAt(0)&&(r="#"+i[s]),r.toLowerCase()==a.postsTemp[t].hashtags[o].toLowerCase()&&(a.posts.push(a.postsTemp[t]),o=a.postsTemp[t].hashtags.length)}}console.log(e)},function(e){console.error(e)})}}else a.searchStr=void 0},a.newPage=function(e){0<=e&&e<=a.strani&&e!=a.trenStran&&(0==e&&(e=1),a.trenStran=e,s.getPosts().then(function(e){var t=[];t=e.data,a.posts=[];var o=t.length,s=(a.trenStran-1)*a.maxNaStran,r=s+a.maxNaStran;a.trenStran*a.maxNaStran>o&&(r-=a.trenStran*a.maxNaStran-o);for(var n=s;n<r;n++)a.posts.push(t[n]),0;t=[],console.log(e)},function(e){console.error(e)}))}}e.$inject=["$scope","$rootScope","$uibModal","aggAppPosts","aggAppUsers"],angular.module("aggApp").controller("indexCtrl",e)}(),angular.module("aggApp").directive("glava",function(){return{restrict:"EA",templateUrl:"/layout/glava/glava.controller.html"}}),function(){function e(e,t,s,o){var r=this;r.postID=t.id,s.getPostByID(r.postID).then(function(e){r.post=e.data,o.getUsers().then(function(e){r.users=e.data,console.log(e)},function(e){console.error(e)}),console.log(e)},function(e){console.error(e)}),r.dodajComment=function(e){r.desRes=!1;var t={owner:e._id,content:r.comment},o=new RegExp("^(?=.{1,500}$)[a-žA-Ž0-9#-.!?( )]+$");t.content&&o.test(t.content)?(r.post.comments.push(t),s.addComm(r.postID,r.post.title,r.post.owner,r.post.body,r.post.description,r.post.hashtags,r.post.likes,r.post.dislikes,r.post.comments).then(function(e){r.desRes="success",r.comment="",console.log(e)},function(e){console.error(e),r.desRes="err"})):r.desRes="true"},r.izbrisiPost=function(e){o.getUserByID(r.post.owner).then(function(e){r.user=e.data;var t=r.user.posts.indexOf(r.postID);-1!=t&&(r.user.posts.splice(t,1),s.deletePost(r.post._id).then(function(e){o.updateUser(r.user._id,r.user).then(function(e){r.response="success"},function(e){console.error(e),r.response="errorUser"})},function(e){console.error(e),r.response="error"}))},function(e){console.error(e),r.response="errorUser"})}}e.$inject=["$scope","$routeParams","aggAppPosts","aggAppUsers"],angular.module("aggApp").controller("postsCtrl",e)}(),function(){function e(u){return{getUsers:function(){return u.get("/api/users")},getUserByID:function(e){return u.get("/api/users/"+e)},updateUser:function(e,t){return u.put("/api/users/"+e,t)},postUser:function(e,t,o,s,r,n,i,a,p,l){return u.post("/api/users/",{identity:e,username:t,name:o,surname:s,profilePicture:r,posts:n,postReactions:i,points:a,dateJoined:p,dateLastActive:l})}}}e.$inject=["$http"],angular.module("aggApp").service("aggAppUsers",e)}(),function(){function e(o,e,t,s,r,n){var i=this;i.userID=e.id,n.getUserByID(i.userID).then(function(e){i.user=e.data;var t=e.data.posts;i.userPosts=new Array;for(var o=0;o<t.length;o++)r.getPostByID(t[o]).then(function(e){i.userPosts.push(e.data)},function(e){console.log(e)})},function(e){console.error(e)}),i.checkBtn=function(e){return-1==o.rootUser.postReactions.indexOf(e)?"btn-circle btn-circle-default":"btn-circle btn-circle-success"},i.reactP=function(e){var t=o.rootUser.postReactions.indexOf(e);-1==t?(i.user=o.rootUser,i.user.postReactions.push(e),r.getPostByID(e).then(function(e){i.post=e.data,i.post.likes=i.post.likes+1,n.updateUser(i.user._id,i.user).then(function(e){r.editPost(i.post._id,i.post.title,i.post.owner,i.post.body,i.post.description,i.post.hashtags,i.post.likes,i.post.dislikes,i.post.comments).then(function(e){i.response="success"},function(e){console.error(e),i.response="errorPost"})},function(e){console.error(e),i.response="errorUser"})},function(e){console.error(e),i.response="errorPost"})):(i.user=o.rootUser,i.user.postReactions.splice(t,1),r.getPostByID(e).then(function(e){i.post=e.data,i.post.likes=i.post.likes-1,n.updateUser(i.user._id,i.user).then(function(e){r.editPost(i.post._id,i.post.title,i.post.owner,i.post.body,i.post.description,i.post.hashtags,i.post.likes,i.post.dislikes,i.post.comments).then(function(e){i.response="success"},function(e){console.error(e),i.response="errorPost"})},function(e){console.error(e),i.response="errorUser"})},function(e){console.error(e),i.response="errorPost"}))},i.logout=function(){o.rootUser=null,t.path("/"),s.reload()}}e.$inject=["$rootScope","$routeParams","$location","$route","aggAppPosts","aggAppUsers"],angular.module("aggApp").controller("usersCtrl",e)}(),function(){function e(s,r,e,t){var n=this;n.prijavniPodatki={email:"",password:""},e.getUsersIdentity().then(function(e){n.usersIdentity=e.data,console.log(n.usersIdentity)},function(e){console.error(e)});var i=!1;n.login=function(){var e=new RegExp("^(?![.])(?!.*[.]{2})[a-zA-Z0-9.!#$%&'*+-/=?^_`{|}~]+(?<![.])@(?![-])[a-zA-Z0-9-]+(?<![-]).(?![.])(?!.*[.]{2})[a-zA-Z0-9.]+(?<![.])$");if(new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})(?![s])").test(n.prijavniPodatki.password)&&e.test(n.prijavniPodatki.email))for(var o in n.usersIdentity)if(n.prijavniPodatki.email===n.usersIdentity[o].email&&n.prijavniPodatki.password===n.usersIdentity[o].password){i=!0,t.getUsers().then(function(e){for(var t in e.data)e.data[t].identity===n.usersIdentity[o]._id&&(s.rootUser=e.data[t],r.path("/"))},function(e){console.error(e)});break}i||(n.response="failure")}}e.$inject=["$rootScope","$location","aggAppUsersIdentity","aggAppUsers"],angular.module("aggApp").controller("loginCtrl",e)}(),function(){function e(e,t,n,i){var a=this;a.prijavniPodatki={name:"",surname:"",username:"",email:"",password:"",password2:"",profilePic:""},a.register=function(){var e=new RegExp("^(?=.{4,20}$)[a-žA-Ž0-9-()]+$"),t=new RegExp("^(?![.])(?!.*[.]{2})[a-zA-Z0-9.!#$%&'*+-/=?^_`{|}~]+(?<![.])@(?![-])[a-zA-Z0-9-]+(?<![-]).(?![.])(?!.*[.]{2})[a-zA-Z0-9.]+(?<![.])$"),o=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})(?![s])"),s=new RegExp("^(?=.{1,50}$)(?![ ])[a-žA-Ž-( )]+(?<![ ])$"),r=0;e.test(a.prijavniPodatki.username)||(a.usernameRes="true",r=1),t.test(a.prijavniPodatki.email)||(a.emailRes="true",r=1),o.test(a.prijavniPodatki.password)?a.prijavniPodatki.password!=a.prijavniPodatki.password2&&(a.pass2Res="true",r=1):(a.passRes="true",r=1),s.test(a.prijavniPodatki.name)||(a.nameRes="true",r=1),s.test(a.prijavniPodatki.surname)||(a.surnameRes="true",r=1),0==r&&n.postUserIdentity(a.prijavniPodatki.email,a.prijavniPodatki.password,"user").then(function(e){console.log("UserIdentititeta POST"),console.log(e.data),i.postUser(e.data._id,a.prijavniPodatki.username,a.prijavniPodatki.name,a.prijavniPodatki.surname,a.prijavniPodatki.profilePic,[],[],0,null,null).then(function(e){a.response="success",console.log(e)},function(e){a.response="errorUser",console.log(e)})},function(e){a.response="errorUserIdentity",console.log(e)})}}e.$inject=["$rootScope","$location","aggAppUsersIdentity","aggAppUsers"],angular.module("aggApp").controller("registerCtrl",e)}(),function(){function e(s){return{getUsersIdentity:function(){return s.get("/api/userIdentities")},getUserIdentityByID:function(e){return s.get("/api/userIdentities/"+e)},postUserIdentity:function(e,t,o){return s.post("/api/userIdentities/",{email:e,password:t,userType:o})},putUserIdentity:function(e,t,o){return s.put("/api/userIdentities/"+e,{email:t,password:o})}}}e.$inject=["$http"],angular.module("aggApp").service("aggAppUsersIdentity",e)}(),function(){function e(e,t,r,n){var i=this;i.userID=t.id,i.typeID=t.idd,i.title="",i.url="",i.description="",i.tags="",i.dodajPost=function(){var e;if(3==i.typeID)e={bodyType:"text",content:""};else if(1==i.typeID)e={bodyType:"image",content:i.url};else{var t;-1!==(t=-1!==i.url.indexOf("youtube.com/watch?v=")?i.url.substr(i.url.indexOf("youtube.com/watch?v=")+20):-1!==i.url.indexOf("youtube.com/watch/?v=")?i.url.substr(i.url.indexOf("youtube.com/watch/?v=")+21):-1!==i.url.indexOf("youtu.be")?i.url.substr(i.url.indexOf("youtu.be")+9):-1!==i.url.indexOf("www.youtube.com/embed/")?i.url.substr(i.url.indexOf("www.youtube.com/embed/")+22):-1!==i.url.indexOf("?v=")?i.url.substr(i.url.indexOf("?v=")+3,11):(console.warn("YouTubeUrlNormalize getVidId not a youTube Video: "+i.url),null)).indexOf("&")&&(t=t.substr(0,t.indexOf("&"))),null!=t&&(i.url="https://www.youtube.com/embed/"+t),e={bodyType:"embed",content:i.url}}i.titleRes="false",i.urlRes="false",i.desRes="false",i.tagsRes="false";var o=0;new RegExp("^(#[a-žA-Ž0-9]+( )?)+$").test(i.tags)||(o=1,i.tagsRes="true"),new RegExp("^(?=.{1,500}$)[a-žA-Ž0-9#-.!?( )]+$").test(i.description)||(o=1,i.desRes="true");var s=new RegExp("^(http://www.|https://www.|http://|https://)?[a-z0-9]+([-.]{1}[a-z0-9]+)*.[a-z]{2,5}(:[0-9]{1,5})?(/.*)?$");i.typeID3&&!s.test(i.url)&&(o=1,i.urlRes="true"),new RegExp("^(?=.{1,20}$)[a-žA-Ž0-9( )]+$").test(i.title)||(o=1,i.titleRes="true"),0==o&&(i.tags=i.tags.split(" "),r.addPost(i.title,i.userID,e,i.description,i.tags,0,0,{}).then(function(t){n.getUserByID(i.userID).then(function(e){console.log(e),e.data.posts.push(t.data._id),n.updateUser(i.userID,e.data).then(function(e){i.response="success",i.title=void 0,i.url=void 0,i.description=void 0,i.tags=void 0,console.log(e)},function(e){i.response="errorUpdate",console.log(e)})},function(e){console.log(e),i.response="errorGet"}),console.log(t)},function(e){console.error(e),i.response="errorAdd"}))}}e.$inject=["$rootScope","$routeParams","aggAppPosts","aggAppUsers"],angular.module("aggApp").controller("addPostsCtrl",e)}(),function(){function e(e,t,o,s,r,a,p){var l=this;l.userID=t.id,a.getUserByID(l.userID).then(function(e){l.user=e.data;var t=e.data.posts;l.userPosts=new Array;for(var o=0;o<t.length;o++)r.getPostByID(t[o]).then(function(e){l.userPosts.push(e.data)},function(e){console.log(e)})},function(e){console.error(e)}),l.editP=function(e){var t=new RegExp("^(?=.{4,20}$)[a-žA-Ž0-9-( )]+$"),o=new RegExp("^(?![.])(?!.*[.]{2})[a-zA-Z0-9.!#$%&'*+-/=?^_`{|}~]+(?<![.])@(?![-])[a-zA-Z0-9-]+(?<![-]).(?![.])(?!.*[.]{2})[a-zA-Z0-9.]+(?<![.])$"),s=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})(?![s])"),r=new RegExp("^(?=.{1,50}$)(?![ ])[a-žA-Ž-( )]+(?<![ ])$");l.usernameRes="false",l.emailRes="false",l.passRes="false",l.pass2Res="false",l.nameRes="false",l.surnameRes="false",l.response="false",l.noviUser={posts:l.user.posts,postReactions:l.user.postReactions,points:l.user.points,_id:l.user._id,identity:l.user.identity,username:l.novUsername,name:l.novName,surname:l.novSurname,profilePicture:l.url,dateLastActive:l.user.dateLastActive},l.noviIdentity={_id:l.noviUser.identity,email:l.novEmail,password:l.novPassword},p.getUsersIdentity().then(function(e){console.log("break"),console.log(e.data)},function(e){console.error(e)});var n=new RegExp("^(http://www.|https://www.|http://|https://)?[a-z0-9]+([-.]{1}[a-z0-9]+)*.[a-z]{2,5}(:[0-9]{1,5})?(/.*)?$"),i=0;l.novUsername&&l.novName&&l.novSurname&&l.noviIdentity.email&&l.noviIdentity.password?(l.url?n.test(l.url)&&(i=1):l.noviUser.profilePicture=l.user.profilePicture,t.test(l.novUsername)||(l.usernameRes="true",i=1),o.test(l.noviIdentity.email)||(l.emailRes="true",i=1),s.test(l.noviIdentity.password)?l.noviIdentity.password!=l.novPassword2&&(l.pass2Res="true",i=1):(l.passRes="true",i=1),r.test(l.novName)||(l.nameRes="true",i=1),r.test(l.novSurname)||(l.surnameRes="true",i=1),0==i&&a.updateUser(l.noviUser._id,l.noviUser).then(function(e){p.putUserIdentity(l.noviIdentity._id,l.noviIdentity.email,l.noviIdentity.password).then(function(e){},function(e){console.error(e),l.response="errorAdd"}),l.response="success",console.log(e)},function(e){console.error(e),l.response="errorAdd"})):l.response="brezp"}}e.$inject=["$rootScope","$routeParams","$location","$route","aggAppPosts","aggAppUsers","aggAppUsersIdentity"],angular.module("aggApp").controller("editProfileCtrl",e)}(),function(){function e(e,t,o,s){var r=this;r.postID=t.id,o.getPostByID(r.postID).then(function(e){r.post=e.data,s.getUsers().then(function(e){r.users=e.data,console.log(e)},function(e){console.error(e)}),console.log(e)},function(e){console.error(e)}),r.editPo=function(){if(r.novDescription&&r.novTags){var e=0;new RegExp("^(#[a-žA-Ž0-9]+( )?)+$").test(r.novTags)||(e=1,r.tagsRes="true"),r.novTags=r.novTags.split(" "),new RegExp("^(?=.{1,500}$)[a-žA-Ž0-9#-.!?( )]+$").test(r.novDescription)||(e=1,r.desRes="true"),0==e&&o.editPost(r.post._id,r.post.title,r.post.owner,r.post.body,r.novDescription,r.novTags,r.post.likes,r.post.dislikes,r.post.comments).then(function(e){r.response="success",console.log(e)},function(e){console.error(e),r.response="errorAdd"})}else r.response="brezp"}}e.$inject=["$scope","$routeParams","aggAppPosts","aggAppUsers"],angular.module("aggApp").controller("editPostCtrl",e)}(),function(){function e(l){return{getPosts:function(){return l.get("/api/posts")},getPostByID:function(e){return l.get("/api/posts/"+e)},addPost:function(e,t,o,s,r,n,i,a){return l.post("/api/posts",{title:e,owner:t,body:o,description:s,hashtags:r,likes:n,dislikes:i,comments:a})},addComm:function(e,t,o,s,r,n,i,a,p){return l.put("/api/posts/"+e,{title:t,owner:o,body:s,description:r,hashtags:n,likes:i,dislikes:a,comments:p})},editPost:function(e,t,o,s,r,n,i,a,p){return l.put("/api/posts/"+e,{title:t,owner:o,body:s,description:r,hashtags:n,likes:i,dislikes:a,comments:p})},deletePost:function(e){return l.delete("/api/posts/"+e)}}}e.$inject=["$http"],angular.module("aggApp").service("aggAppPosts",e)}(),function(){function e(t,o){var s=function(e){t.localStorage["Aggregate-token"]=e},r=function(){return t.localStorage["Aggregate-token"]},e=function(){var e=r();return!!e&&JSON.parse(t.atob(e.split(".")[1])).datumPoteka>Date.now()/1e3};return{saveToken:s,getToken:r,registration:function(e){return o.post("/api/registracija",e).then(function(e){s(e.data.zeton)})},login:function(e){return o.post("/api/prijava",e).then(function(e){s(e.data.zeton)})},logout:function(){t.localStorage.removeItem("Aggregate-token")},isLoggedIn:e,currentUser:currentUser}}e.$inject=["$window","$http"],angular.module("aggApp").service("auth",e)}();